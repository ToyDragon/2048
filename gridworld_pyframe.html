<!DOCTYPE html>
<html>
  <body>
    <script id="pyScript" type="text/python"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.9.0/brython.js" type="text/javascript"></script>
    <script>
      window.gridworldCommand = function(message, arg) {
        postMessage("gridworld__internal__command:" + message + ":" + arg);
      }
      var oldLog = console.log;
      console.log = function() {
        //oldLog.apply(null, arguments);
        var str = "";
        for (let i = 0; i < arguments.length; ++i) {
          str += arguments[i];
        }
        window.gridworldCommand("print", str);
      }

      window.addEventListener("message", function(e) {
        if (e.data.indexOf("gridworld__internal__script:") === 0) {
          var code = e.data.substr("gridworld__internal__script:".length);
          document.querySelector("#pyScript").innerHTML = 
            "from browser import window\n" +
            "def gridworld__internal__onMessage(e):\n" +
            "  if e.data == \"gridworld__internal__tick\":\n" +
            "    tick()\n" +
            "window.addEventListener(\"message\", gridworld__internal__onMessage)\n" +
            "def tick(): return\n" + 
            "def start(): return\n" +
            code + "\n" + 
            "start()\n";
          brython();
        }
      });
    </script>
  </body>
</html>